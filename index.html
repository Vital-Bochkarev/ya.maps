<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Карта с мультиполигонами</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
  <style>
    html, body {height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    #wrap {display:grid; grid-template-columns:360px 1fr; height:100%;}
    #list {border-right:1px solid #e5e7eb; overflow:auto;}
    #map {width:100%; height:100%;}
    .list-header {position:sticky; top:0; background:#fff; z-index:1; padding:.5rem .75rem; border-bottom:1px solid #e5e7eb; font-weight:600;}
    table {width:100%; border-collapse:collapse;}
    thead th {text-align:left; font-weight:600; color:#6b7280; padding:.5rem .75rem; position:sticky; top:36px; background:#fff; border-bottom:1px solid #e5e7eb;}
    tbody td {padding:.5rem .75rem; border-bottom:1px solid #f3f4f6;}
    tbody tr {cursor:pointer;}
    tbody tr:hover {background:#f9fafb;}
    #diag {position:fixed; right:8px; bottom:8px; background:#111; color:#fff; padding:4px 8px; border-radius:6px; font:12px monospace; opacity:.85; z-index:9999;}
  </style>
</head>
<body>
<div id="wrap">
  <aside id="list">
    <div class="list-header">Список объектов</div>
    <table>
      <thead><tr><th style="width:55%">Городской округ</th><th>Название</th></tr></thead>
      <tbody id="featList"><tr><td colspan="2">Загрузка…</td></tr></tbody>
    </table>
  </aside>
  <div id="map"></div>
</div>
<div id="diag">init…</div>

<script>
const SRC_GEOJSON =
 "https://gist.githubusercontent.com/Vital-Bochkarev/b96a1680d32b83086de812eddabb31cf/raw/69ce2f478a9f8990b482fdd6348de02387593212/map.geojson";

const esc = s => String(s ?? '').replace(/[&<>\"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[ch]));

ymaps.ready(init);

function init() {
  const map = new ymaps.Map("map", {
    center:[55.75,37.61], zoom:9,
    controls:['zoomControl','typeSelector','fullscreenControl']
  }, {suppressMapOpenBlock:true});

  // Подложки Яндекса: схема, спутник, гибрид доступны в typeSelector
  map.controls.get('typeSelector').options.set('size','large');

  const featureLayers = [];

  fetch(SRC_GEOJSON,{cache:"no-store"})
    .then(r=>r.json())
    .then(fc=>{
      const geoObjects = new ymaps.GeoObjectCollection();
      fc.features.forEach((f,i)=>{
        const gj = {
          type:"FeatureCollection",
          features:[f]
        };
        const obj = ymaps.geoQuery(gj)
          .applyBoundsToMap(map, {checkZoomRange:true})
          .addToMap(map)
          .setOptions({
            fillColor:'#ff669955',
            strokeColor:'#ff0055',
            strokeWidth:2
          });
        featureLayers.push(obj.get(0));
        geoObjects.add(obj);
      });

      buildList(fc, i=>{
        const obj=featureLayers[i];
        if(obj){
          const bounds=obj.geometry.getBounds();
          if(bounds) map.setBounds(bounds,{checkZoomRange:true, zoomMargin:20});
        }
      });

      document.getElementById("diag").textContent =
        "OK: объектов на карте: "+featureLayers.length;
    })
    .catch(e=>{
      console.error(e);
      document.getElementById("diag").textContent="Ошибка GeoJSON";
    });
}

function buildList(fc, focus){
  const tbody=document.getElementById("featList");
  tbody.innerHTML="";
  fc.features.forEach((f,i)=>{
    const p=f.properties||{};
    const okrug=p.Name??p.NAME??p.name??p.title??'—';
    const name=p.description??'—';
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${esc(okrug)}</td><td>${esc(name)}</td>`;
    tr.onclick=()=>focus(i);
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
